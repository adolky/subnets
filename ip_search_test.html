<!DOCTYPE html>
<html>
<head>
    <title>Quick IP Search Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-left: 3px solid #ddd; }
        .success { border-color: #4CAF50; background: #f1f8e9; }
        .error { border-color: #f44336; background: #ffebee; }
        .test-code { font-family: monospace; background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç IP Search Function Test</h1>
    
    <div id="testResults"></div>
    
    <div class="test-code">
        <h3>Test Code:</h3>
        <pre id="testCode"></pre>
    </div>

    <script>
        // Copy the key functions from subnets.html for testing
        
        function isValidIP(ip) {
            const parts = ip.split('.');
            if (parts.length !== 4) return false;
            
            for (let part of parts) {
                const num = parseInt(part);
                if (isNaN(num) || num < 0 || num > 255) return false;
            }
            
            return true;
        }
        
        function ipToNumber(ip) {
            const parts = ip.split('.').map(part => parseInt(part));
            return (parts[0] << 24) + (parts[1] << 16) + (parts[2] << 8) + parts[3];
        }
        
        function isIPInSubnet(ip, subnet, mask) {
            const ipNum = ipToNumber(ip);
            const subnetNum = ipToNumber(subnet);
            const maskNum = (0xFFFFFFFF << (32 - mask)) >>> 0;
            
            return (ipNum & maskNum) === (subnetNum & maskNum);
        }
        
        // Mock function to simulate finding subnet in table
        function findSubnetForIP(targetIP) {
            // Simulate table with test data
            const mockTableData = [
                "192.168.9.0/26 (64 hosts)",  // This should match 192.168.9.6
                "192.168.9.64/27 (32 hosts)",
                "192.168.9.96/27 (32 hosts)",
                "192.168.9.128/25 (128 hosts)"
            ];
            
            console.log(`Testing IP: ${targetIP}`);
            
            for (let cellText of mockTableData) {
                console.log(`Checking cell: ${cellText}`);
                
                // Use regex to extract network/mask
                const cidrMatch = cellText.match(/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\/(\d{1,2})/);
                
                if (cidrMatch) {
                    const network = cidrMatch[1];
                    const mask = parseInt(cidrMatch[2]);
                    
                    console.log(`Found CIDR: ${network}/${mask}`);
                    
                    if (isIPInSubnet(targetIP, network, mask)) {
                        console.log(`‚úÖ IP ${targetIP} found in subnet ${network}/${mask}`);
                        return `${network}/${mask}`;
                    }
                }
            }
            
            console.log(`‚ùå IP ${targetIP} not found in any subnet`);
            return null;
        }
        
        // Run tests
        function runTests() {
            const results = [];
            const testCases = [
                { ip: "192.168.9.6", expected: "192.168.9.0/26", description: "IP in first subnet" },
                { ip: "192.168.9.65", expected: "192.168.9.64/27", description: "IP in second subnet" },
                { ip: "192.168.9.200", expected: "192.168.9.128/25", description: "IP in last subnet" },
                { ip: "10.0.0.1", expected: null, description: "IP outside range" },
                { ip: "999.999.999.999", expected: "invalid", description: "Invalid IP format" }
            ];
            
            testCases.forEach((testCase, index) => {
                console.log(`\n--- Test ${index + 1}: ${testCase.description} ---`);
                
                let result;
                let status;
                let message;
                
                if (!isValidIP(testCase.ip) && testCase.expected === "invalid") {
                    result = "invalid";
                    status = "success";
                    message = `‚úÖ Correctly identified invalid IP: ${testCase.ip}`;
                } else if (!isValidIP(testCase.ip)) {
                    result = "invalid";
                    status = "error";
                    message = `‚ùå Should have validated IP: ${testCase.ip}`;
                } else {
                    result = findSubnetForIP(testCase.ip);
                    
                    if (result === testCase.expected) {
                        status = "success";
                        message = `‚úÖ ${testCase.description}: ${testCase.ip} ‚Üí ${result || 'not found'}`;
                    } else {
                        status = "error";
                        message = `‚ùå ${testCase.description}: ${testCase.ip} ‚Üí Expected: ${testCase.expected || 'not found'}, Got: ${result || 'not found'}`;
                    }
                }
                
                results.push({ ...testCase, result, status, message });
            });
            
            return results;
        }
        
        // Display results
        const testResults = runTests();
        const resultsDiv = document.getElementById('testResults');
        
        testResults.forEach(test => {
            const div = document.createElement('div');
            div.className = `test-result ${test.status}`;
            div.innerHTML = `
                <strong>Test:</strong> ${test.description}<br>
                <strong>Input:</strong> ${test.ip}<br>
                ${test.message}
            `;
            resultsDiv.appendChild(div);
        });
        
        // Show test summary
        const passed = testResults.filter(t => t.status === 'success').length;
        const total = testResults.length;
        
        const summary = document.createElement('div');
        summary.className = `test-result ${passed === total ? 'success' : 'error'}`;
        summary.innerHTML = `
            <h3>Test Summary</h3>
            <strong>Passed:</strong> ${passed}/${total} tests<br>
            <strong>Status:</strong> ${passed === total ? '‚úÖ All tests passed!' : '‚ùå Some tests failed'}
        `;
        resultsDiv.appendChild(summary);
        
        // Show the test code
        document.getElementById('testCode').textContent = `
// Key test: IP 192.168.9.6 should be found in subnet 192.168.9.0/26

Input IP: 192.168.9.6
Target Subnet: 192.168.9.0/26

IP as number: ${ipToNumber('192.168.9.6')} 
Subnet as number: ${ipToNumber('192.168.9.0')}
Mask (26 bits): ${(0xFFFFFFFF << (32 - 26)) >>> 0}

IP & Mask: ${ipToNumber('192.168.9.6') & ((0xFFFFFFFF << (32 - 26)) >>> 0)}
Subnet & Mask: ${ipToNumber('192.168.9.0') & ((0xFFFFFFFF << (32 - 26)) >>> 0)}

Match: ${(ipToNumber('192.168.9.6') & ((0xFFFFFFFF << (32 - 26)) >>> 0)) === (ipToNumber('192.168.9.0') & ((0xFFFFFFFF << (32 - 26)) >>> 0))}
        `;
        
        console.log('\nüéØ Key Fix Applied:');
        console.log('Before: Complex table cell parsing with DOM traversal');
        console.log('After: Direct regex pattern matching for CIDR notation');
        console.log('Pattern: /(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\/(\\d{1,2})/');
    </script>
</body>
</html>