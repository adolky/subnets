<!DOCTYPE html>
<html>
<head>
    <title>Search Feature Live Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .test-item { margin: 10px 0; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>Search Feature Live Test</h1>
    
    <div class="test-section">
        <h3>Available Test Data</h3>
        <div id="testData">Loading...</div>
    </div>
    
    <div class="test-section">
        <h3>Search Tests</h3>
        <div id="searchTests">
            <div class="test-item">
                <strong>Test 1:</strong> Search for "192.168" (IP address)
                <button onclick="testSearch('192.168')">Test</button>
                <div id="result1"></div>
            </div>
            <div class="test-item">
                <strong>Test 2:</strong> Search for "home" (site name)
                <button onclick="testSearch('home')">Test</button>
                <div id="result2"></div>
            </div>
            <div class="test-item">
                <strong>Test 3:</strong> Search for "45" (admin number)
                <button onclick="testSearch('45')">Test</button>
                <div id="result3"></div>
            </div>
            <div class="test-item">
                <strong>Test 4:</strong> Search for "/24" (CIDR notation)
                <button onclick="testSearch('/24')">Test</button>
                <div id="result4"></div>
            </div>
            <div class="test-item">
                <strong>Test 5:</strong> Search for "nonexistent" (no results)
                <button onclick="testSearch('nonexistent')">Test</button>
                <div id="result5"></div>
            </div>
        </div>
    </div>

    <script>
        let testConfigurations = [];
        
        // Load test data from API
        async function loadTestData() {
            try {
                const response = await fetch('api.php?action=list');
                const result = await response.json();
                
                if (result.success) {
                    testConfigurations = result.data;
                    document.getElementById('testData').innerHTML = 
                        `<strong>Found ${testConfigurations.length} configurations:</strong><br>` +
                        testConfigurations.map(config => 
                            `• ID: ${config.id}, Site: ${config.site_name}, Admin: ${config.admin_number}, Network: ${config.network_address}`
                        ).join('<br>');
                } else {
                    document.getElementById('testData').innerHTML = 
                        `<span class="error">Error: ${result.message}</span>`;
                }
            } catch (error) {
                document.getElementById('testData').innerHTML = 
                    `<span class="error">Error loading data: ${error.message}</span>`;
            }
        }
        
        // Simulate the search functionality from our main app
        function searchConfigurations(searchTerm) {
            if (searchTerm.trim() === '') {
                return testConfigurations;
            }
            
            const term = searchTerm.toLowerCase().trim();
            return testConfigurations.filter(config => {
                const searchFields = [
                    config.network_address || '',
                    config.admin_number || '',
                    config.site_name || '',
                    config.location || '',
                    config.description || '',
                    config.vlan_names || ''
                ];
                
                const searchableText = searchFields.join(' ').toLowerCase();
                
                if (term.includes('/') || term.includes('.')) {
                    return searchableText.includes(term) || 
                           (config.network_address && config.network_address.toLowerCase().includes(term));
                } else {
                    return searchableText.includes(term);
                }
            });
        }
        
        // Test search functionality
        function testSearch(term, testNum) {
            const results = searchConfigurations(term);
            const resultDiv = document.getElementById(`result${testNum || ''}`);
            
            if (results.length === 0) {
                resultDiv.innerHTML = `<span class="info">No matches found for "${term}"</span>`;
            } else {
                resultDiv.innerHTML = 
                    `<span class="success">Found ${results.length} matches for "${term}":</span><br>` +
                    results.map(config => 
                        `• ${config.site_name} (${config.admin_number}) - ${config.network_address}`
                    ).join('<br>');
            }
        }
        
        // Auto-run tests when page loads
        window.onload = async function() {
            await loadTestData();
            
            // Auto-run all tests after a short delay
            setTimeout(() => {
                testSearch('192.168', 1);
                testSearch('home', 2);
                testSearch('45', 3);
                testSearch('/24', 4);
                testSearch('nonexistent', 5);
            }, 1000);
        };
    </script>
</body>
</html>